<!DOCTYPE html><html class=writer-html5 lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content="Vishal Koparde, Ph.D., Samantha Sevilla, PhD."><link rel="shortcut icon" href=../../img/favicon.ico><title>Helix2HPCDME - CCBR How Tos</title><link rel=stylesheet href=../../css/theme.css><link rel=stylesheet href=../../css/theme_extra.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css><link href=../../css/version-select.css rel=stylesheet><script>
        // Current page data
        var mkdocs_page_name = "Helix2HPCDME";
        var mkdocs_page_input_path = "HPCDME/transferFromHelix.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script><script>hljs.highlightAll();</script></head> <body class=wy-body-for-nav role=document> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class="wy-nav-side stickynav"> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=../.. class="icon icon-home"> CCBR How Tos </a><div role=search> <form id=rtd-search-form class=wy-form action=../../search.html method=get> <input type=text name=q placeholder="Search docs" aria-label="Search docs" title="Type search term here"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="Navigation menu"> <ul> <li class=toctree-l1><a class="reference internal" href=../..>Intro</a> </li> </ul> <p class=caption><span class=caption-text>GitHub</span></p> <ul> <li class=toctree-l1><a href=../../GitHub/overview/ class="reference internal">Overview</a> </li> <li class=toctree-l1><a class="reference internal">Set-Up</a> <ul> <li class=toctree-l2><a href=../../GitHub/howto_setup/ class="reference internal">Preparing your environment</a> </li> <li class=toctree-l2><a href=../../GitHub/howto_functions/ class="reference internal">Basic Commands</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">Basics</a> <ul> <li class=toctree-l2><a href=../../GitHub/basic_repo/ class="reference internal">Creating your GitHub Repo</a> </li> <li class=toctree-l2><a href=../../GitHub/basic_docs/ class="reference internal">Creating your Documentation</a> </li> <li class=toctree-l2><a href=../../GitHub/basic_actions/ class="reference internal">Creating GitHub Actions</a> </li> <li class=toctree-l2><a href=../../GitHub/howto_precommit/ class="reference internal">Using Pre-Commit</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">Best Practices</a> <ul> <li class=toctree-l2><a href=../../GitHub/sop_projpipes/ class="reference internal">Projects,Pipelines</a> </li> <li class=toctree-l2><a href=../../GitHub/sop_techdev/ class="reference internal">TechDev</a> </li> </ul> </li> </ul> <p class=caption><span class=caption-text>TechDev</span></p> <ul> <li class=toctree-l1><a href=../../GitHub/sop_techdev/ class="reference internal">TechDev</a> </li> </ul> <p class=caption><span class=caption-text>HPCDME</span></p> <ul class=current> <li class=toctree-l1><a href=../setup/ class="reference internal">Setup</a> </li> <li class=toctree-l1><a href=../transfer/ class="reference internal">Biowulf2HPCDME</a> </li> <li class="toctree-l1 current"><a class="reference internal current" href=#>Helix2HPCDME</a> <ul class=current> <li class=toctree-l2><a class="reference internal" href=#background>Background</a> </li> <li class=toctree-l2><a class="reference internal" href=#parkit>parkit</a> <ul> <li class=toctree-l3><a class="reference internal" href=#projark-usage>projark usage</a> <ul> <li class=toctree-l4><a class="reference internal" href=#load-conda-env>load conda env</a> </li> <li class=toctree-l4><a class="reference internal" href=#projark-help>projark help</a> </li> </ul> </li> <li class=toctree-l3><a class="reference internal" href=#projark-testing>projark testing</a> <ul> <li class=toctree-l4><a class="reference internal" href=#get-dummy-data>get dummy data</a> </li> <li class=toctree-l4><a class="reference internal" href=#run-projark>run projark</a> </li> <li class=toctree-l4><a class="reference internal" href=#verify-transfer>verify transfer</a> </li> <li class=toctree-l4><a class="reference internal" href=#cleanup>cleanup</a> </li> </ul> </li> </ul> </li> </ul> </li> </ul> <p class=caption><span class=caption-text>UCSC Tracks</span></p> <ul> <li class=toctree-l1><a href=../../UCSC/overview/ class="reference internal">Overview</a> </li> <li class=toctree-l1><a href=../../UCSC/creating_inputs/ class="reference internal">Creating Inputs</a> </li> <li class=toctree-l1><a href=../../UCSC/creating_track_info/ class="reference internal">Creating Tracks Info</a> </li> <li class=toctree-l1><a href=../../UCSC/creating_tracks/ class="reference internal">Creating Tracks</a> </li> </ul> <p class=caption><span class=caption-text>Creating an R Package</span></p> <ul> <li class=toctree-l1><a href=../../Rpackage/setup/ class="reference internal">Set-Up</a> </li> <li class=toctree-l1><a href=../../Rpackage/build_pkg/ class="reference internal">Creating the package</a> </li> <li class=toctree-l1><a href=../../Rpackage/common_issues/ class="reference internal">Troubleshooting</a> </li> </ul> <p class=caption><span class=caption-text>Other How Tos</span></p> <ul> <li class=toctree-l1><a href=../../OtherHowTos/datashare/ class="reference internal">Datashare</a> </li> <li class=toctree-l1><a href=../../OtherHowTos/zenodo/ class="reference internal">Zenodo</a> </li> <li class=toctree-l1><a href=../../OtherHowTos/lucidcharts/ class="reference internal">LucidCharts</a> </li> </ul> <p class=caption><span class=caption-text>Tutorials</span></p> <ul> <li class=toctree-l1><a href=../../Tutorials/snakemake/ class="reference internal">Snakemake</a> </li> </ul> <ul> <li class=toctree-l1><a href=../../contributions/ class="reference internal">Contributions</a> </li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap> <nav class=wy-nav-top role=navigation aria-label="Mobile navigation menu"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=../..>CCBR How Tos</a> </nav> <div class=wy-nav-content> <div class=rst-content><div role=navigation aria-label="breadcrumbs navigation"> <ul class=wy-breadcrumbs> <li><a href=../.. class="icon icon-home" aria-label=Docs></a></li> <li class=breadcrumb-item>HPCDME</li> <li class="breadcrumb-item active">Helix2HPCDME</li> <li class=wy-breadcrumbs-aside> </li> </ul> <hr> </div> <div role=main class=document itemscope=itemscope itemtype=http://schema.org/Article> <div class=section itemprop=articleBody> <h1 id=file-transfer-from-helix>File Transfer from HELIX<a class=headerlink href=#file-transfer-from-helix title="Permanent link">&para;</a></h1> <h2 id=background><a name=Background></a>Background<a class=headerlink href=#background title="Permanent link">&para;</a></h2> <p>Rawdata or Project folders from Helix can be parked at a secure location after the analysis has reached an endpoint. Traditionally, CCBR analysts have been using GridFTP Globus Archive for doing this. But, this Globus Archive has been running relatively full lately and it is hard to estimate how much space is left there as the volume is shared among multiple groups.</p> <h2 id=parkit><a name=parkit></a>parkit<a class=headerlink href=#parkit title="Permanent link">&para;</a></h2> <p><a href=https://github.com/CCBR/parkit><strong>parkit</strong></a> is designed to assist analysts in archiving project data from the NIH's Helix/Helix systems to the HPC-DME storage platform. It provides functionalities to package and store data such as raw FastQ files or processed data from bioinformatics pipelines. Users can automatically: - create tarballs of their data (including <code>.filelist</code> and <code>.md5sum</code> files), - generate metadata, - create collections on HPC-DME, and - deposit tar files into the system for long-term storage. <strong>parkit</strong> also features comprehensive workflows that support both folder-based and tarball-based archiving. This integration ensures that bioinformatics project data is securely archived and well-organized, allowing for seamless long-term storage.</p> <blockquote> <p>❗ <strong>NOTE</strong>: HPC DME API CLUs should already be setup as per <a href=../setup/ >these</a> instructions in order to use <strong>parkit</strong></p> <p>❗ <strong>NOTE</strong>: <code>HPC_DM_UTILS</code> environment variable should be set to point to the <code>utils</code> folder under the <code>HPC_DME_APIs</code> repo setup. Please see <a href=../setup/#edit-bashrc>these</a> instructions.</p> <p>❗ <strong>NOTE</strong>: If it has been a few months since you last used HPC_DME_APIs or parkit or projark, then please run the following commands before you start using <code>parkit</code> or <code>projark</code>: </p> <p><code>cd $HPC_DM_UTILS</code></p> <p><code>git pull</code> </p> <p><code>source $HPC_DM_UTILS/functions</code></p> <p><code>dm_generate_token</code></p> </blockquote> <p><a href=https://github.com/CCBR/parkit><code>projark</code></a> is the preferred <strong>parkit</strong> command to completely archive an entire folder as a tarball on HPCDME. SLURM is not available on Helix and it could take a few hours to upload large files. Hence, it is recommended to use "tmux" or "screen" command for <code>projark</code> to continue running even when you log out of Helix.</p> <blockquote> <p>❗ <strong>NOTE</strong>: Run the following commands inside a screen or tmux session.</p> </blockquote> <h3 id=projark-usage><a name=projarkusage></a><code>projark</code> usage<a class=headerlink href=#projark-usage title="Permanent link">&para;</a></h3> <h4 id=load-conda-env>load conda env<a class=headerlink href=#load-conda-env title="Permanent link">&para;</a></h4> <pre class=highlight><code class=language-bash># source conda
. "/data/CCBR_Pipeliner/db/PipeDB/Conda/etc/profile.d/conda.sh"
# activate parkit or parkit_dev environment
conda activate parkit
# check version of parkit
parkit --version
projark --version</code></pre> <details> <summary><em>Expected sample output</em></summary> <pre class=highlight><code class=language-bash>v2.1.2
projark is using the following parkit version:
v2.1.2</code></pre> </details> <h4 id=projark-help>projark help<a class=headerlink href=#projark-help title="Permanent link">&para;</a></h4> <pre class=highlight><code class=language-bash>projark --help</code></pre> <details> <summary><em>Expected sample output</em></summary> <pre class=highlight><code class=language-bash>usage: projark [-h] --folder FOLDER --projectnumber PROJECTNUMBER
               [--executor EXECUTOR] [--rawdata] [--cleanup]

Wrapper for folder2hpcdme for quick CCBR project archiving!

options:
  -h, --help            show this help message and exit
  --folder FOLDER       Input folder path to archive
  --projectnumber PROJECTNUMBER
                        CCBR project number.. destination will be
                        /CCBR_Archive/GRIDFTP/Project_CCBR-&lt;projectnumber&gt;
  --executor EXECUTOR   slurm or local
  --rawdata             If tarball is rawdata and needs to go under folder
                        Rawdata
  --cleanup             post transfer step to delete local files</code></pre> </details> <h3 id=projark-testing><a name=projarktest></a><code>projark</code> testing<a class=headerlink href=#projark-testing title="Permanent link">&para;</a></h3> <h4 id=get-dummy-data>get dummy data<a class=headerlink href=#get-dummy-data title="Permanent link">&para;</a></h4> <pre class=highlight><code class=language-bash># make a tmp folder
mkdir -p /data/$USER/parkit_tmp
# copy dummy project folder into the tmp folder
cp -r /data/CCBR/projects/CCBR-12345 /data/$USER/parkit_tmp/CCBR-12345-$USER
# check if HPC_DM_UTILS has been set
echo $HPC_DM_UTILS</code></pre> <h4 id=run-projark>run <code>projark</code><a class=headerlink href=#run-projark title="Permanent link">&para;</a></h4> <pre class=highlight><code class=language-bash>projark --folder /data/$USER/parkit_tmp/CCBR-12345-$USER --projectnumber 12345-$USER --executor local</code></pre> <blockquote> <p>❗ <strong>NOTE</strong>: <code>--executor slurm</code> will not work on Helix</p> </blockquote> <details> <summary><em>Expected sample output</em></summary> <pre class=highlight><code class=language-bash>SOURCE_CONDA_CMD is set to: . "/data/CCBR_Pipeliner/db/PipeDB/Conda/etc/profile.d/conda.sh"
HPC_DM_UTILS is set to: /data/kopardevn/GitRepos/HPC_DME_APIs/utils
parkit_folder2hpcdme --folder "/data/$USER/parkit_tmp/CCBR-12345-$USER" --dest "/CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn" --projecttitle "CCBR-12345-kopardevn" --projectdesc "CCBR-12345-kopardevn" --executor "local" --hpcdmutilspath /data/kopardevn/GitRepos/HPC_DME_APIs/utils --makereadme
################ Running createtar #############################
parkit createtar --folder "/data/$USER/parkit_tmp/CCBR-12345-$USER"
tar cvf /data/$USER/parkit_tmp/CCBR-12345-$USER.tar /data/$USER/parkit_tmp/CCBR-12345-$USER &gt; /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.filelist
createmetadata: /data/$USER/parkit_tmp/CCBR-12345-$USER.tar file was created!
createmetadata: /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.filelist file was created!
createmetadata: /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.md5 file was created!
createmetadata: /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.filelist.md5 file was created!
################################################################
############ Running createemptycollection ######################
parkit createemptycollection --dest "/CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn" --projectdesc "CCBR-12345-kopardevn" --projecttitle "CCBR-12345-kopardevn"
module load java/11.0.21 &amp;&amp; source $HPC_DM_UTILS/functions &amp;&amp; dm_register_collection /dev/shm/a213dedc-9363-44ec-8a7a-d29f2345a0b5.json /CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn
cat /dev/shm/a213dedc-9363-44ec-8a7a-d29f2345a0b5.json &amp;&amp; rm -f /dev/shm/a213dedc-9363-44ec-8a7a-d29f2345a0b5.json
module load java/11.0.21 &amp;&amp; source $HPC_DM_UTILS/functions &amp;&amp; dm_register_collection /dev/shm/cabf7826-81b5-4b6a-addd-09fbcf279591.json /CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn/Analysis
module load java/11.0.21 &amp;&amp; source $HPC_DM_UTILS/functions &amp;&amp; dm_register_collection /dev/shm/cabf7826-81b5-4b6a-addd-09fbcf279591.json /CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn/Rawdata
cat /dev/shm/cabf7826-81b5-4b6a-addd-09fbcf279591.json &amp;&amp; rm -f /dev/shm/cabf7826-81b5-4b6a-addd-09fbcf279591.json
################################################################
########### Running createmetadata ##############################
parkit createmetadata --tarball "/data/$USER/parkit_tmp/CCBR-12345-$USER.tar" --dest "/CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn"
createmetadata: /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.metadata.json file was created!
createmetadata: /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.filelist.metadata.json file was created!
################################################################
############# Running deposittar ###############################
parkit deposittar --tarball "/data/$USER/parkit_tmp/CCBR-12345-$USER.tar" --dest "/CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn"
module load java/11.0.21 &amp;&amp; source $HPC_DM_UTILS/functions &amp;&amp; dm_register_dataobject /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.filelist.metadata.json /CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn/Analysis/CCBR-12345.tar.filelist /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.filelist
module load java/11.0.21 &amp;&amp; source $HPC_DM_UTILS/functions &amp;&amp; dm_register_dataobject_multipart /data/$USER/parkit_tmp/CCBR-12345-$USER.tar.metadata.json /CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn/Analysis/CCBR-12345.tar /data/$USER/parkit_tmp/CCBR-12345-$USER.tar
################################################################</code></pre> </details> <blockquote> <p>❗ <strong>NOTE</strong>: add <code>--rawdata</code> when folder contains raw fastqs</p> </blockquote> <h4 id=verify-transfer>verify transfer<a class=headerlink href=#verify-transfer title="Permanent link">&para;</a></h4> <p>Transfer can be verified by logging into <a href=https://hpcdmeweb.nci.nih.gov/browse?base>HPC DME web interface</a>.</p> <p><img alt="alt text" src=../verification.png></p> <h4 id=cleanup>cleanup<a class=headerlink href=#cleanup title="Permanent link">&para;</a></h4> <p>Delete unwanted collection from HPC DME.</p> <pre class=highlight><code class=language-bash># load java
module load java
# load dm_ commands
source $HPC_DM_UTILS/functions
# delete collection recursively
dm_delete_collection -r /CCBR_Archive/GRIDFTP/Project_CCBR-12345-$USER</code></pre> <details> <summary><em>Expected sample output</em></summary> <pre class=highlight><code class=language-bash>Reading properties from /data/kopardevn/GitRepos/HPC_DME_APIs/utils/hpcdme.properties
WARNING: You have requested recursive delete of the collection. This will delete all files and sub-collections within it recursively. Are you sure you want to proceed? (Y/N):
Y
Would you like to see the list of files to delete ?
N
The collection /CCBR_Archive/GRIDFTP/Project_CCBR-12345-kopardevn and all files and sub-collections within it will be recursively deleted. Proceed with deletion ? (Y/N):
Y
Executing: https://hpcdmeapi.nci.nih.gov:8080/collection
Wrote results into /data/kopardevn/HPCDMELOG/tmp/getCollections_Records20241010.txt
Cmd process Completed
Oct 10, 2024 4:43:09 PM org.springframework.shell.core.AbstractShell handleExecutionResult
INFO: CLI_SUCCESS</code></pre> </details> <blockquote> <p>⚠️ Reach out to <a href=mailto:vishal.koparde@nih.gov>Vishal Koparde</a> in case you run into issues.</p> </blockquote> </div> </div><footer> <div class=rst-footer-buttons role=navigation aria-label="Footer Navigation"> <a href=../transfer/ class="btn btn-neutral float-left" title=Biowulf2HPCDME><span class="icon icon-circle-arrow-left"></span> Previous</a> <a href=../../UCSC/overview/ class="btn btn-neutral float-right" title=Overview>Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr> <div role=contentinfo> <!-- Copyright etc --> <p>Copyright &copy; 2025 CCBR</p> </div> Built with <a href=https://www.mkdocs.org/ >MkDocs</a> using a <a href=https://github.com/readthedocs/sphinx_rtd_theme>theme</a> provided by <a href=https://readthedocs.org>Read the Docs</a>. </footer> </div> </div> </section> </div> <div class=rst-versions role=note aria-label=Versions> <span class=rst-current-version data-toggle=rst-current-version> <span> <a href=https://github.com/CCBR/HowTos class="fa fa-code-fork" style="color: #fcfcfc"> CCBR/HowTos</a> </span> <span><a href=../transfer/ style="color: #fcfcfc">&laquo; Previous</a></span> <span><a href=../../UCSC/overview/ style="color: #fcfcfc">Next &raquo;</a></span> </span> </div> <script src=../../js/jquery-3.6.0.min.js></script> <script>var base_url = "../..";</script> <script src=../../js/theme_extra.js></script> <script src=../../js/theme.js></script> <script src=../../search/main.js></script> <script src=../../js/version-select.js></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 